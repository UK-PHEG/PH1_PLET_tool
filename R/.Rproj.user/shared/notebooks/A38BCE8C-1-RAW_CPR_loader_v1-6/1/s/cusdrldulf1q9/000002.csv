"0","#load CPR headers"
"0","df_cpr_headers <- as.data.frame(fread(paste0(dir_cpr, ""CPR_OSPAR_1960_2019_data.csv""), nrow=2, header=FALSE))"
"0","headers_names <- sapply(df_cpr_headers, paste, collapse=""_"")"
"0","headers_names <- gsub(""'"", """", headers_names)"
"0","rm(df_cpr_headers)"
"0",""
"0","#load CPR data and apply headers to data"
"0","df_cpr <- fread(paste0(dir_cpr, ""CPR_OSPAR_1960_2019_data.csv""), skip = 2, header=FALSE)"
"0","names(df_cpr) <- headers_names"
"0","rm(headers_names)"
"0",""
"0","#melting the data in records"
"0","id_vars <- c(""_Lat"",""_Lon"",""_Year"",""_Month"", ""_Day"",""_Hour"", ""_Minute"")"
"0","measure_vars <- colnames(df_cpr)[!(colnames(df_cpr) %in% id_vars)]"
"0","df_cpr <- data.table::melt(df_cpr, id.vars = id_vars,"
"0","                           measure.vars = measure_vars,"
"0","                           value.name = ""count"")"
"0","rm(id_vars, measure_vars)"
"0",""
"0","df_cpr$variable <- as.character(df_cpr$variable)"
"0",""
"0","df_cpr <- df_cpr[, c(""taxon"", ""cpr_id"") "
"0","      := as.list(strsplit(variable, ""_"")[[1]]), by=variable ]"
"0",""
"0","#remove column that has now been separated"
"0","df_cpr <- df_cpr[,variable:=NULL]"
"0",""
"0","#fix column names"
"0","cols <- names(df_cpr)[1:7]"
"0","cols <- tolower(gsub(""_"", """", cols))"
"0","df_cpr <- setnames(df_cpr, 1:7, cols)"
"0",""
"0","#remove taxa that were not looked for before a certain date"
"0","df_nan <- df_cpr %>%"
"0","  dplyr::select(taxon, count) %>%"
"0","  filter(is.nan(count)) %>%"
"0","  distinct(.keep_all = TRUE) %>%"
"0","  dplyr::select(taxon)"
"0",""
"0","df_cpr <- df_cpr %>%"
"0","  filter(!(taxon %in% all_of(df_nan$taxon)))"
"0",""
"0","rm(df_nan)"
